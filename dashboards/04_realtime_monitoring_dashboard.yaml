# Real-time Monitoring Dashboard
# Live monitoring van alle energie stromen

views:
  - title: Live Monitor
    path: live-monitor
    icon: mdi:monitor-dashboard
    cards:
      # Header
      - type: custom:mushroom-title-card
        title: Real-time Monitor
        subtitle: Live energie stromen
        
      # Hoofdmeting
      - type: custom:mushroom-template-card
        primary: "{{ states('sensor.house_net_power') }} W"
        secondary: >
          {{ states('sensor.capacity_status') }}
          | Grid: {{ states('sensor.grid_flow_direction') }}
        icon: mdi:home-lightning-bolt
        icon_color: >
          {% set pct = states('sensor.capacity_percentage') | float(0) %}
          {% if pct < 70 %} green
          {% elif pct < 90 %} yellow
          {% else %} red
          {% endif %}
        badge_icon: >
          {% if is_state('binary_sensor.new_month_peak_warning', 'on') %}
            mdi:alert-circle
          {% endif %}
        badge_color: red
        tap_action:
          action: more-info
          
      # Live gauges
      - type: horizontal-stack
        cards:
          - type: gauge
            entity: sensor.capacity_percentage
            name: Capaciteit
            needle: true
            severity:
              green: 0
              yellow: 70
              red: 90
          - type: gauge
            entity: sensor.available_capacity
            name: Beschikbaar
            unit: W
            needle: true
            min: 0
            max: 5000
            severity:
              red: 0
              yellow: 1000
              green: 2000
              
      # Live power flow
      - type: custom:power-flow-card-plus
        entities:
          grid:
            entity: sensor.eth_dongle_pro_power_delivered
            name: Grid
            icon: mdi:transmission-tower
            color:
              - [0, green]
              - [1000, yellow]
              - [3000, orange]
              - [4000, red]
          home:
            entity: sensor.house_net_power
            name: Huis
            icon: mdi:home
          individual:
            - entity: sensor.ev_estimated_power
              name: EV
              icon: mdi:car-electric
              color: green
            - entity: sensor.vaatwas_power
              name: Vaatwasser
              icon: mdi:dishwasher
              display_zero: false
            - entity: sensor.metered_wall_plug_switch_power
              name: Wasmachine
              icon: mdi:washing-machine
              display_zero: false
            - entity: sensor.droogkast_power
              name: Droogkast
              icon: mdi:tumble-dryer
              display_zero: false
              
      # Real-time waarschuwingen
      - type: conditional
        conditions:
          - entity: binary_sensor.new_month_peak_warning
            state: "on"
        card:
          type: custom:mushroom-template-card
          primary: ⚠️ NIEUWE MAANDPIEK!
          secondary: >
            Huidig: {{ states('sensor.house_net_power') }}W
            Was: {{ states('sensor.home_import_power_peak_31d') }}W
          icon: mdi:alert
          icon_color: red
          tap_action:
            action: none
            
      - type: conditional
        conditions:
          - entity: binary_sensor.high_consumption_warning
            state: "on"
        card:
          type: custom:mushroom-template-card
          primary: Hoog Verbruik Gedetecteerd
          secondary: >
            {{ states('sensor.house_net_power') }}W - 
            2x hoger dan normaal
          icon: mdi:flash-alert
          icon_color: orange
          
      # Live apparaten
      - type: glance
        title: Actieve Apparaten
        entities:
          - entity: sensor.vaatwasser_status
            name: Vaatwasser
          - entity: sensor.washing_machine_status
            name: Wasmachine
          - entity: sensor.dryer_status
            name: Droogkast
          - entity: sensor.ev_estimated_power
            name: EV Laden
        state_color: true
        show_state: true
        
      # Live grafiek
      - type: custom:apexcharts-card
        header:
          show: true
          title: Live Verbruik (5 min)
        graph_span: 5min
        update_interval: 5s
        apex_config:
          chart:
            animations:
              enabled: true
              dynamicAnimation:
                speed: 200
        series:
          - entity: sensor.house_net_power
            name: Totaal
            type: line
            stroke_width: 3
            color: blue
          - entity: sensor.fluvius_capacity_limit
            name: Limiet
            type: line
            stroke_width: 2
            color: red
            opacity: 0.5
          - entity: sensor.home_import_power_peak_31d
            name: Maandpiek
            type: line
            stroke_width: 1
            color: orange
            opacity: 0.5
        yaxis:
          - min: 0
            max: ~6000
            decimals: 0
            
      # Quick actions
      - type: horizontal-stack
        cards:
          - type: custom:mushroom-entity-card
            entity: input_boolean.ev_force_max
            name: Max Laden
            icon: mdi:flash
            fill_container: true
            tap_action:
              action: toggle
          - type: custom:mushroom-entity-card
            entity: input_boolean.peak_protection_active
            name: Piek Beveiliging
            icon: mdi:shield
            fill_container: true
            tap_action:
              action: toggle
              
      # Live stats
      - type: entities
        title: Live Statistieken
        entities:
          - entity: sensor.cost_per_hour
            name: Kosten per uur
            icon: mdi:currency-eur
          - entity: sensor.ev_tijd_sinds_aanpassing
            name: Load balancer timer
            icon: mdi:timer
          - entity: sensor.dagen_tot_piek_reset
            name: Piek reset over
            icon: mdi:calendar-refresh
          - type: divider
          - type: custom:template-entity-row
            name: Projectie vandaag
            state: >
              {{ states('sensor.daggemiddelde_verbruik') | round(1) }} kWh
              (€{{ (states('sensor.daggemiddelde_verbruik') | float(0) * states('input_number.electricity_energy_price') | float(0.25)) | round(2) }})
            icon: mdi:crystal-ball