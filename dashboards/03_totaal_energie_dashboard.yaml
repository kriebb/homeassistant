# Totaal Energie Dashboard
# Overzicht van elektriciteit, gas en totale kosten

views:
  - title: Energie Totaal
    path: energie-totaal
    icon: mdi:home-lightning-bolt
    cards:
      # Header
      - type: custom:mushroom-title-card
        title: Energie Overzicht
        subtitle: Elektriciteit, Gas & Kosten
        
      # Dagelijkse kosten overzicht
      - type: horizontal-stack
        cards:
          - type: custom:mushroom-entity-card
            entity: sensor.daily_energy_cost
            name: Elektriciteit
            icon: mdi:lightning-bolt
            icon_color: yellow
            
          - type: custom:mushroom-entity-card
            entity: sensor.gas_kosten_vandaag
            name: Gas
            icon: mdi:fire
            icon_color: orange
            
          - type: custom:mushroom-entity-card
            entity: sensor.totale_energie_kosten_vandaag
            name: Totaal Vandaag
            icon: mdi:currency-eur
            icon_color: green
            
      # Maandelijkse projectie
      - type: custom:mushroom-template-card
        primary: Geschatte Maandkosten
        secondary: >
          Energie: ‚Ç¨{{ ((states('sensor.totale_energie_kosten_vandaag') | float / now().day * 30) if now().day > 0 else 0) | round(2) }}
          + Capaciteit: ‚Ç¨{{ states('sensor.geschatte_capaciteitstarief_kost') | round(2) }}
          = ‚Ç¨{{ states('sensor.totale_energie_kosten_schatting_maand') | round(2) }}
        icon: mdi:calendar-month
        icon_color: >
          {% set cost = states('sensor.totale_energie_kosten_schatting_maand') | float(0) %}
          {% if cost < 150 %} green
          {% elif cost < 200 %} yellow
          {% elif cost < 250 %} orange
          {% else %} red
          {% endif %}
          
      # Verbruik meters
      - type: horizontal-stack
        cards:
          - type: gauge
            entity: sensor.daily_energy_consumption
            name: Elektriciteit Vandaag
            unit: kWh
            min: 0
            max: 50
            severity:
              green: 0
              yellow: 20
              red: 35
              
          - type: gauge
            entity: sensor.gas_verbruik_vandaag
            name: Gas Vandaag
            unit: kWh
            min: 0
            max: 100
            severity:
              green: 0
              yellow: 50
              red: 80
              
      # Tarieven overzicht
      - type: entities
        title: Energie Tarieven
        entities:
          - type: section
            label: Elektriciteit
          - entity: input_number.elektriciteit_energieprijs
            name: Energieprijs
          - entity: input_number.capaciteitstarief_prijs_per_kw
            name: Capaciteitstarief
          - type: section
            label: Gas (incl. BTW)
          - type: custom:template-entity-row
            entity: sensor.gas_totaalprijs_per_kwh
            name: Totaalprijs Gas
            secondary: >
              Energie: ‚Ç¨{{ state_attr('sensor.gas_totaalprijs_per_kwh', 'energieprijs') }}
              + Net: ‚Ç¨{{ state_attr('sensor.gas_totaalprijs_per_kwh', 'nettarieven') }}
              + Taksen: ‚Ç¨{{ state_attr('sensor.gas_totaalprijs_per_kwh', 'taksen') }}
            state: "‚Ç¨{{ states('sensor.gas_totaalprijs_per_kwh') }}"
            
      # Verhouding elektriciteit vs gas
      - type: custom:mushroom-template-card
        primary: Energie Mix Vandaag
        secondary: "{{ states('sensor.energie_kosten_verhouding') }}"
        icon: mdi:chart-pie
        icon_color: blue
        
      # Historie grafiek
      - type: custom:apexcharts-card
        header:
          show: true
          title: Dagelijks Verbruik (7 dagen)
        graph_span: 7d
        series:
          - entity: sensor.daily_energy_consumption
            name: Elektriciteit
            type: column
            color: yellow
            group_by:
              func: max
              duration: 1d
          - entity: sensor.gas_verbruik_vandaag
            name: Gas
            type: column
            color: orange
            group_by:
              func: max
              duration: 1d
        yaxis:
          - min: 0
            decimals: 0
            apex_config:
              title:
                text: kWh
                
      # Slimme apparaten overzicht
      - type: entities
        title: Grote Verbruikers
        entities:
          - type: custom:template-entity-row
            entity: switch.wallbox_kristof_riebbels_pauzeren_hervatten
            name: EV Laden
            secondary: "{{ states('sensor.wallbox_kristof_riebbels_laadvermogen') | round(0) }} W"
            icon: mdi:ev-station
            state: >
              {% if is_state('switch.wallbox_kristof_riebbels_pauzeren_hervatten', 'on') %}
                Gepauzeerd
              {% elif states('sensor.wallbox_kristof_riebbels_laadvermogen') | float > 100 %}
                Actief
              {% else %}
                Standby
              {% endif %}
          - type: custom:template-entity-row
            entity: switch.vaatwas
            name: Vaatwasser
            secondary: "{{ states('sensor.vaatwas_power') | round(0) }} W"
            icon: mdi:dishwasher
          - type: custom:template-entity-row
            entity: switch.metered_wall_plug_switch
            name: Wasmachine
            secondary: "{{ states('sensor.metered_wall_plug_switch_power') | round(0) }} W"
            icon: mdi:washing-machine
          - type: custom:template-entity-row
            entity: switch.droogkast
            name: Droogkast
            secondary: "{{ states('sensor.droogkast_power') | round(0) }} W"
            icon: mdi:tumble-dryer
          - type: custom:template-entity-row
            entity: switch.waterker
            name: Boiler
            secondary: "{{ states('sensor.waterker_power') | round(0) }} W"
            icon: mdi:water-boiler
            
      # Optimalisatie status
      - type: markdown
        content: |
          ## üìä Status & Optimalisatie
          
          **Capaciteit:**
          - Gebruikt: **{{ states('sensor.ev_house_power') | round(0) }} W** van **{{ (states('sensor.home_import_power_peak_31d') | float) | round(0) }} W** piek
          - Beschikbaar: **{{ states('sensor.available_capacity') | round(0) }} W**
          
          **Slimme Spreiding:** {% if is_state('input_boolean.smart_spreading_active', 'on') %}‚úÖ Actief{% else %}‚ùå Uit{% endif %}
          
          **Optimalisatie:** {{ states('sensor.energie_optimalisatie_potentieel') }}