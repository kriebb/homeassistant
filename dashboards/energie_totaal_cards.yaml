# Energie Totaal Dashboard Cards
# Voeg deze cards toe aan je dashboard voor volledig inzicht

# Totaal overzicht card
type: vertical-stack
cards:
  - type: custom:mushroom-title-card
    title: Energie Overzicht
    subtitle: Elektriciteit, Gas & Capaciteitstarief

  # Kosten vandaag
  - type: horizontal-stack
    cards:
      - type: custom:mushroom-entity-card
        entity: sensor.daily_energy_cost
        name: Elektriciteit
        icon: mdi:lightning-bolt
        icon_color: yellow
        
      - type: custom:mushroom-entity-card
        entity: sensor.gas_kosten_vandaag
        name: Gas
        icon: mdi:fire
        icon_color: orange
        
      - type: custom:mushroom-entity-card
        entity: sensor.totale_energie_kosten_vandaag
        name: Totaal
        icon: mdi:currency-eur
        icon_color: green

  # Capaciteitstarief monitoring
  - type: custom:mushroom-template-card
    primary: Capaciteitstarief Status
    secondary: >
      {{ states('sensor.capaciteit_status') }}
      Piek: {{ (states('sensor.home_import_power_peak_31d') | float / 1000) | round(2) }} kW
    icon: mdi:gauge
    icon_color: >
      {% set percentage = state_attr('sensor.capaciteit_status', 'percentage_used') | float(0) %}
      {% if percentage < 50 %} green
      {% elif percentage < 80 %} orange
      {% else %} red
      {% endif %}
    tap_action:
      action: more-info
      entity: sensor.capaciteit_status
    badge_icon: >
      {% if is_state('binary_sensor.new_month_peak_warning', 'on') %}
        mdi:alert
      {% endif %}
    badge_color: red

  # Real-time verbruik gauge
  - type: gauge
    entity: sensor.ev_house_power
    name: Huidig Verbruik
    min: 0
    max: 7000
    segments:
      - from: 0
        color: green
      - from: 3000
        color: yellow
      - from: 4362
        color: orange
      - from: 5000
        color: red
    needle: true

  # Slimme spreiding controls
  - type: entities
    title: Slimme Spreiding
    entities:
      - entity: input_boolean.smart_spreading_active
        name: Automatische spreiding
      - entity: input_boolean.peak_protection_active
        name: Piek bescherming
      - entity: input_select.energy_priority_mode
        name: Prioriteit modus

  # Apparaten status
  - type: custom:auto-entities
    card:
      type: entities
      title: Actieve Verbruikers
    filter:
      include:
        - entity_id: "switch.vaatwas"
          options:
            secondary_info: >
              {{ states('sensor.vaatwas_power') | round(0) }} W
        - entity_id: "switch.metered_wall_plug_switch"
          name: Wasmachine
          options:
            secondary_info: >
              {{ states('sensor.metered_wall_plug_switch_power') | round(0) }} W
        - entity_id: "switch.droogkast"
          options:
            secondary_info: >
              {{ states('sensor.droogkast_power') | round(0) }} W
        - entity_id: "switch.waterker"
          name: Boiler
          options:
            secondary_info: >
              {{ states('sensor.waterker_power') | round(0) }} W
      exclude:
        - state: "off"
        - state: "unavailable"

  # Optimalisatie suggesties
  - type: markdown
    content: >
      ## üí° Optimalisatie Tips
      
      **Huidige maandpiek:** {{ (states('sensor.home_import_power_peak_31d') | float / 1000) | round(2) }} kW
      
      **Beschikbare ruimte:** {{ states('sensor.available_capacity') }} W
      
      {% if states('sensor.energie_optimalisatie_potentieel') != 'Goed geoptimaliseerd' %}
      **Besparingspotentieel:** {{ states('sensor.energie_optimalisatie_potentieel') }}
      {% endif %}
      
      {% if is_state('binary_sensor.new_month_peak_warning', 'on') %}
      ‚ö†Ô∏è **Let op:** Je bent een nieuwe maandpiek aan het zetten!
      {% endif %}
      
      ### Tips:
      1. Start zware apparaten niet tegelijk
      2. Laad je EV 's nachts of bij lage belasting
      3. Gebruik de volledige capaciteit tot je piek (geen extra kosten)
      4. Vermijd nieuwe pieken boven {{ (states('sensor.home_import_power_peak_31d') | float / 1000) | round(1) }} kW

# Historisch verbruik grafiek
type: custom:apexcharts-card
header:
  show: true
  title: Verbruikspatroon Vandaag
graph_span: 24h
series:
  - entity: sensor.ev_house_power
    name: Totaal verbruik
    color: blue
    type: line
    group_by:
      func: avg
      duration: 15min
  - entity: sensor.home_import_power_peak_31d
    name: Maandpiek
    color: red
    type: line
  - entity: sensor.ev_estimated_charger_power
    name: EV Laden
    color: green
    type: area
    opacity: 0.3
yaxis:
  - min: 0
    max: ~5000
    decimals: 0