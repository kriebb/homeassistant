# EV Laadsessie Dashboard
# Track je laadsessies en optimaliseer je laadkosten

views:
  - title: EV Laden
    path: ev-laden
    icon: mdi:ev-station
    cards:
      # Header
      - type: custom:mushroom-title-card
        title: EV Laadmanagement
        subtitle: Slim laden met capaciteitsbeheer
        
      # Laadstatus
      - type: tile
        entity: sensor.ev_estimated_power
        name: Laadvermogen
        state_content:
          - state
          - last-changed
        color: state
        
      # Load balancer status
      - type: entities
        title: Load Balancer
        entities:
          - entity: binary_sensor.ev_load_balancer_ready
            name: Load Balancer Actief
          - entity: sensor.ev_available_capacity
            name: Beschikbare EV Capaciteit
          - entity: input_number.ev_last_set_current_a
            name: Huidige Instelling
          - entity: input_boolean.ev_force_max
            name: Force Maximum Laden
            
      # Ampere controle
      - type: horizontal-stack
        cards:
          - type: custom:mushroom-number-card
            entity: input_number.wallbox_min_amp
            name: Min Ampere
            display_mode: buttons
            icon: mdi:current-ac
          - type: custom:mushroom-number-card
            entity: input_number.wallbox_max_amp
            name: Max Ampere  
            display_mode: buttons
            icon: mdi:current-ac
            
      # Sessie info
      - type: entities
        title: Laadsessie
        show_header_toggle: false
        entities:
          - type: custom:template-entity-row
            entity: sensor.ev_laadsessie_duur
            name: Duur
            state: >
              {% set duur = states('sensor.ev_laadsessie_duur') | int(0) %}
              {% if duur > 60 %}
                {{ (duur / 60) | int }}u {{ duur % 60 }}m
              {% else %}
                {{ duur }}m
              {% endif %}
          - entity: input_number.ev_session_kwh_total
            name: Geladen kWh
          - entity: sensor.ev_laadsessie_kosten
            name: Sessie Kosten
          - entity: sensor.ev_laadsnelheid_kmh
            name: Laadsnelheid
            
      # Laadgrafiek
      - type: custom:apexcharts-card
        header:
          show: true
          title: Laadverloop
        graph_span: 3h
        update_interval: 30s
        series:
          - entity: sensor.ev_estimated_power
            name: Laadvermogen
            type: line
            color: green
            unit: W
          - entity: sensor.house_net_power
            name: Totaal Verbruik
            type: line
            color: blue
            unit: W
          - entity: sensor.fluvius_capacity_limit
            name: Capaciteitslimiet
            type: line
            color: red
            stroke_width: 2
            unit: W
        yaxis:
          - min: 0
            decimals: 0
            apex_config:
              title:
                text: Vermogen (W)
                
      # Non-EV verbruik
      - type: entities
        title: Verbruik Analyse
        entities:
          - entity: sensor.non_ev_load
            name: Non-EV Verbruik
            icon: mdi:home
          - entity: sensor.ev_estimated_power
            name: EV Verbruik
            icon: mdi:car-electric
          - entity: sensor.house_net_power
            name: Totaal Verbruik
            icon: mdi:lightning-bolt
            
      # Tijd sinds aanpassing
      - type: custom:mushroom-template-card
        primary: Load Balancer Status
        secondary: >
          {% set tijd = states('sensor.ev_tijd_sinds_aanpassing') | int(0) %}
          Laatste aanpassing: {{ tijd }}s geleden
          {% if tijd > 120 %}
            (Stabiel)
          {% elif tijd > 60 %}
            (Stabiliserend)
          {% else %}
            (Actief aanpassen)
          {% endif %}
        icon: mdi:scale-balance
        icon_color: >
          {% set tijd = states('sensor.ev_tijd_sinds_aanpassing') | int(0) %}
          {% if tijd > 120 %} green
          {% elif tijd > 60 %} yellow
          {% else %} orange
          {% endif %}
          
      # Tips
      - type: markdown
        content: |
          ## ðŸš— EV Laad Tips
          
          **Load Balancer:**
          - Past automatisch aan op basis van beschikbare capaciteit
          - Minimale aanpassingen om Kia app meldingen te voorkomen
          - Alleen aanpassen bij >2A verschil of na 2 minuten
          
          **Optimaal laden:**
          - Laad 's nachts voor lagere netbelasting
          - Vermijd laden tijdens koken (17:00-20:00)
          - Force max alleen bij haast!